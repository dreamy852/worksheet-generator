<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>OCR</title>
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.1.1/dist/tesseract.min.js"></script>
</head>
<body>
    <h1>Paste image (Ctrl+V) to extract text</h1>
    <div id="status"></div>
    <div id="output"></div>

    <script>
        const statusDiv = document.getElementById('status');
        const outputDiv = document.getElementById('output');
        let worker = null;

        document.addEventListener('paste', async (e) => {
            const items = e.clipboardData.items;
            for (let item of items) {
                if (item.type.startsWith('image/')) {
                    e.preventDefault();
                    const file = item.getAsFile();
                    await processImage(file);
                    break;
                }
            }
        });

        async function processImage(file) {
            statusDiv.textContent = 'Processing...';
            outputDiv.textContent = '';

            try {
                // Terminate existing worker if any
                if (worker) {
                    await worker.terminate();
                    worker = null;
                }

                // Create new worker for each recognition to avoid state issues
                worker = await Tesseract.createWorker('chi_tra+chi_sim+eng');
                
                const { data: { text } } = await worker.recognize(file);
                outputDiv.textContent = text;
                statusDiv.textContent = 'Done';
            } catch (error) {
                statusDiv.textContent = 'Error: ' + (error.message || error);
                outputDiv.textContent = '';
                // Reset worker on error
                if (worker) {
                    try {
                        await worker.terminate();
                    } catch (e) {}
                    worker = null;
                }
            }
        }
    </script>
</body>
</html>
